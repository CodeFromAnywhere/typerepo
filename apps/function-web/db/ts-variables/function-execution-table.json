{
  "createdAt": 1669276190531,
  "updatedAt": 1669276190531,
  "deletedAt": 0,
  "createdFirstAt": 1669276190531,
  "classification": "const",
  "comments": [],
  "isExported": true,
  "name": "FunctionExecutionTable",
  "slug": "function-execution-table",
  "operationRelativeTypescriptFilePath": "src/components/FunctionExecutionTable.tsx",
  "type": {
    "rawType": "(props: { tsFunction?: import(\"/Users/king/King/operations/tools/types/code-types/build/TsFunction\").TsFunction | undefined; functionExecutions: import(\"/Users/king/King/operations/tools/types/code-types/build/FunctionExecution\").FunctionExecution[]; type: \"example\" | \"test\" | \"recent\"; }) => JSX.Element",
    "typeDefinition": {
      "type": "object",
      "properties": {},
      "optional": false
    },
    "typeCoverage": 0,
    "isArray": false,
    "isEnum": false,
    "isObject": true,
    "isPrimitive": false,
    "isEnumLiteral": false,
    "simplifiedSchema": {
      "properties": [],
      "type": "object"
    }
  },
  "value": "(props: {\n  tsFunction?: TsFunction;\n  functionExecutions: FunctionExecution[];\n  type: \"example\" | \"test\" | \"recent\";\n}) => {\n  const { functionExecutions, type, tsFunction } = props;\n\n  const [executionId, setExecutionId] = useStore(\"executionId\");\n  const [initialValues, setInitialValues] = useStore(\"initialValues\");\n\n  const [currentTab, setCurrentTab] = useStore(\"tabs.currentTab\");\n  const [loading, setLoading] = useState<{ [id: string]: number | undefined }>(\n    {}\n  );\n\n  const functionExecutionsQuery = queries.useGetFunctionExecutions(\n    tsFunction?.name\n  );\n\n  if (!tsFunction) {\n    return <Div>Hmmm vremd</Div>;\n  }\n\n  const withLoading = async (\n    callback: () => Promise<void>,\n    id: string,\n    actionNumber: number\n  ) => {\n    setLoading((loading) => ({ ...loading, [id]: actionNumber }));\n\n    await callback();\n\n    setLoading((loading) => ({\n      ...loading,\n      [id]: undefined,\n    }));\n  };\n\n  const finalFunctionExecutions =\n    type === \"example\"\n      ? functionExecutions.filter((item: FunctionExecution) => item.isExample)\n      : type === \"test\"\n      ? functionExecutions.filter((item: FunctionExecution) => item.isTest)\n      : functionExecutions\n          .sort((a, b) => (a.createdAt < b.createdAt ? -1 : 1))\n          .slice(0, 100);\n\n  const isDataLoading =\n    functionExecutionsQuery.isRefetching ||\n    functionExecutionsQuery.isFetching ||\n    functionExecutionsQuery.isLoading;\n  return (\n    <>\n      {isDataLoading ? <FancyLoader big /> : null}\n      <Table\n        data={finalFunctionExecutions}\n        columns={[\n          {\n            name: \"Input\",\n            objectParameterKey: \"inputParameters\",\n            customPresentation: (item) => {\n              return (\n                <td>\n                  {item.inputParameters\n                    ? item.inputParameters.map((inputParameter) => {\n                        return (\n                          <Div className=\"border border-black p-2\">\n                            <MarkdownCodeblock\n                              text={\n                                inputParameter\n                                  ? JSON.stringify(inputParameter, undefined, 2)\n                                  : \"undefined\"\n                              }\n                              extension=\"json\"\n                              minimalMode=\"preview\"\n                              expandedMode=\"scroll\"\n                              isInitiallyExpanded={false}\n                            />\n                          </Div>\n                        );\n                      })\n                    : \"No input\"}\n                </td>\n              );\n            },\n          },\n          {\n            name: \"Output\",\n            objectParameterKey: \"output\",\n            customPresentation: (item) => {\n              return (\n                <td>\n                  <MarkdownCodeblock\n                    text={\n                      item.output\n                        ? JSON.stringify(item.output, undefined, 2)\n                        : \"undefined\"\n                    }\n                    extension=\"json\"\n                    minimalMode=\"preview\"\n                    expandedMode=\"scroll\"\n                    isInitiallyExpanded={false}\n                  />\n                </td>\n              );\n            },\n          },\n          {\n            objectParameterKey: \"description\",\n            name: \"Info\",\n            customPresentation: (item) => {\n              return (\n                <td>\n                  {item.description ? (\n                    <MarkdownView\n                      markdownParse={mdToJsonParse(item.description)}\n                      markdownParseRenderConfig={{\n                        projectRelativeBaseFolderPath: \"\",\n                        projectRelativeMarkdownFilePath: \"\",\n                      }}\n                      view=\"view\"\n                    />\n                  ) : (\n                    <Div />\n                  )}\n                </td>\n              );\n            },\n          },\n          {\n            objectParameterKey: \"id\",\n            name: \"Actions\",\n            customPresentation: (item) => {\n              const actions: ActionItem[] = [\n                // make example\n\n                type !== \"example\"\n                  ? {\n                      id: 1,\n                      title: \"Make example\",\n                      emoji: \"👻\",\n                      onClick: async () => {\n                        withLoading(\n                          async () => {\n                            const apiResult = await api.upsertDbModel(\n                              \"FunctionExecution\",\n                              { ...item, isExample: true }\n                            );\n\n                            functionExecutionsQuery.refetch();\n\n                            // console.log({ apiResult });\n                          },\n                          item.id,\n                          1\n                        );\n                      },\n                    }\n                  : undefined,\n\n                // make test\n\n                type !== \"test\"\n                  ? {\n                      id: 2,\n                      title: \"Make test\",\n                      emoji: \"🔧\",\n                      onClick: async () => {\n                        withLoading(\n                          async () => {\n                            const apiResult = await api.upsertDbModel(\n                              \"FunctionExecution\",\n                              { ...item, isTest: true }\n                            );\n\n                            functionExecutionsQuery.refetch();\n\n                            // console.log({ apiResult });\n                          },\n                          item.id,\n                          2\n                        );\n                      },\n                    }\n                  : undefined,\n\n                // delete (tests and examples)\n                type !== \"recent\"\n                  ? {\n                      id: 3,\n                      title: \"Remove\",\n                      emoji: \"❌\",\n                      onClick: async () => {\n                        withLoading(\n                          async () => {\n                            const apiResult = await api.upsertDbModel(\n                              \"FunctionExecution\",\n                              {\n                                ...item,\n                                isExample:\n                                  type === \"example\" ? false : item.isExample,\n                                isTest: type === \"test\" ? false : item.isTest,\n                              }\n                            );\n\n                            functionExecutionsQuery.refetch();\n\n                            // console.log({ apiResult });\n                          },\n                          item.id,\n                          3\n                        );\n                      },\n                    }\n                  : undefined,\n\n                // fill in in form in tab 1\n                {\n                  id: 4,\n                  title: \"Use in form\",\n                  emoji: \"📝\",\n                  onClick: () => {\n                    // Go to tab\n                    setCurrentTab(1);\n                    setExecutionId(item.id);\n                    setInitialValues(item.inputParameters);\n                  },\n                },\n                // execute directly\n                {\n                  id: 5,\n                  emoji: \"⚡️\",\n                  title: \"Execute\",\n                  onClick: async () => {\n                    withLoading(\n                      async () => {\n                        const apiFunction = api[\n                          tsFunction.name as keyof typeof api\n                        ] as undefined | ((...parameters: any[]) => any);\n\n                        const apiResult = await apiFunction?.(\n                          ...(item.inputParameters || [])\n                        );\n\n                        functionExecutionsQuery.refetch();\n\n                        // console.log({ apiResult });\n                      },\n                      item.id,\n                      5\n                    );\n                  },\n                },\n              ].filter(notEmpty);\n              return (\n                <td>\n                  {actions.map((action) => {\n                    const isLoading = loading[item.id] === action.id;\n                    return (\n                      <Button\n                        type=\"button\"\n                        onClick={action.onClick}\n                        className=\"hover:bg-blue-500  mr-2 rounded-md p-1\"\n                        textClassName=\"text-xs hover:text-white flex flex-row\"\n                      >\n                        {isLoading ? <FancyLoader /> : \"\"}\n                        <P>\n                          {action.emoji} {action.title}\n                        </P>\n                      </Button>\n                    );\n                  })}\n                </td>\n              );\n            },\n          },\n        ]}\n      />\n    </>\n  );\n}",
  "description": "",
  "id": "azhfsdmmmdtmzqzpyebrbvpx"
}