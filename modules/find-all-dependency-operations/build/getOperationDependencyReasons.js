"use strict";
/**
 
Problem: It often occurs that there's one function in an entire operation that requires another operation as a dependency because it requires a single other type or function from there. This shouldn't happen.

If I want to structure my code better, I need a hierarchy for all operations and all functions therein, but for every function I need to see which dependencies it relies on.

*/var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var a in n=arguments[t])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e},__assign.apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var n;e.done?a(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(o,s)}u((r=r.apply(e,n||[])).next())}))},__generator=this&&this.__generator||function(e,n){var t,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=n.call(e,o)}catch(e){i=[6,e],r=0}finally{t=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},__spreadArray=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var r,a=0,i=n.length;a<i;a++)!r&&a in n||(r||(r=Array.prototype.slice.call(n,0,a)),r[a]=n[a]);return e.concat(r||Array.prototype.slice.call(n))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.getOperationDependencyReasons=void 0;var database_1=require("database"),js_util_1=require("js-util"),getOperationDependencyReasons=function(){return __awaiter(void 0,void 0,void 0,(function(){var e,n,t,r,a,i;return __generator(this,(function(o){switch(o.label){case 0:return[4/*yield*/,database_1.db.get("TsImport")];case 1:return e=o.sent(),[4/*yield*/,database_1.db.get("Operation")];case 2:return n=o.sent(),[4/*yield*/,database_1.db.get("TsFunction")];case 3:return t=o.sent(),[4/*yield*/,database_1.db.get("TsInterface")];case 4:return r=o.sent(),a=n.map((function(n){var a=n.dependencies?Object.keys(n.dependencies):void 0,i=e.filter((function(e){return e.operationName===n.name})).filter((function(e){return e.isModuleResolved&&e.isAbsolute})),o=__spreadArray(__spreadArray([],t,!0),r,!0).filter((function(e){return e.operationName===n.name})),s=o.map((function(e){return{name:e.name,fileName:e.operationRelativeTypescriptFilePath,imports:i.filter((function(n){return n.operationRelativeTypescriptFilePath===e.operationRelativeTypescriptFilePath})).map((function(e){return"".concat(e.name," from ").concat(e.module)}))}})),u=i.filter((0,js_util_1.onlyUnique2)((function(e,n){return e.module===n.module}))).map((function(e){return e.module}));return{operationName:n.name,totalInstancesCount:o.length,totalImportCount:i.length,totalDependencyCount:u.length,importDependencies:u,packageJsonDependencies:a,instancesAndTheirImports:s}})),i=function(e,n,t){var r;void 0===t&&(t=[]);var a=(null===(r=e.find((function(e){return e.operationName===n})))||void 0===r?void 0:r.importDependencies)||[],o=a.filter((function(e){return!t.includes(e)}));o.length!==a.length&&console.log("circular skipped");var s=o.map((function(n){return i(e,n,__spreadArray(__spreadArray([],t,!0),o,!0))})).flat();return __spreadArray([n],s,!0).filter((0,js_util_1.onlyUnique2)())},[2/*return*/,a.map((function(e,n,t){var r=i(t,e.operationName);return __assign(__assign({},e),{cumulativeDependencies:r})}))]}}))}))};exports.getOperationDependencyReasons=getOperationDependencyReasons;
//# sourceMappingURL=getOperationDependencyReasons.js.map