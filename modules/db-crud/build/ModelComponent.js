"use strict";var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign.apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModelComponent=exports.getDataParameterNames=void 0;var jsx_runtime_1=require("react/jsx-runtime"),api_1=require("api"),convert_case_1=require("convert-case"),fancy_loader_1=require("fancy-loader"),fs_util_js_1=require("fs-util-js"),js_util_1=require("js-util"),labeled_button_1=require("labeled-button"),markdown_1=require("markdown"),name_conventions_1=require("name-conventions"),react_1=require("react"),react_with_native_1=require("react-with-native"),react_with_native_alert_1=require("react-with-native-alert"),react_with_native_router_1=require("react-with-native-router"),react_with_native_table_1=require("react-with-native-table"),schema_util_1=require("schema-util"),useGetDbModelQuery_1=require("./useGetDbModelQuery"),deleteDbModel=api_1.api.deleteDbModel,getDataParameterNames=function(e){return e.map((function(e){return(0,schema_util_1.getReferenceParameterInfo)(e.name).dataParameterName})).filter(js_util_1.notEmpty)};exports.getDataParameterNames=getDataParameterNames;
/**
 
In the table headings, all xxxSlug, xxxId etc should be called xxx.

In the table values, all slugs and ids should show the name of the instance of the refered model.

It has to be possible to navigate to an id or slug using `#[id] or #[slug]` in the URL, just add div ids to all rows

 */
var ModelComponent=function(e){var t,n,a,r,i,s=e.modelName,l=e.highlight,o=(0,useGetDbModelQuery_1.useGetDbModelQuery)(s),_=api_1.queries.useGetReferencableModelData(s),u=o.isLoading||o.isRefetching||o.isFetching,c=(0,react_1.useState)(!1),d=c[0],m=c[1],v=(0,react_with_native_alert_1.useAlert)(),h=(0,react_with_native_router_1.useRouter)(),f=null===(n=null===(t=o.data)||void 0===t?void 0:t.pages[0].result)||void 0===n?void 0:n.index,p=(0,schema_util_1.getProperties)(null===(a=null==f?void 0:f.type)||void 0===a?void 0:a.typeDefinition),j=(0,exports.getDataParameterNames)(p),x=p.filter((function(e){return!j.includes(e.name)})).map((function(e){var t=(0,schema_util_1.getReferenceParameterInfo)(e.name),n=t.descriptor,a=t.interfaceName,r=t.isReferenceMultipleParameter,i=t.isReferenceParameter,s=t.isReferenceSingleParameter,l=(0,name_conventions_1.getAssetInputType)(e.name),o=s?"referenceSingle":r?"referenceMultiple":l?"backendAsset":"text";return{name:i&&a?n?(0,convert_case_1.humanCase)("".concat(n,"-").concat(a)):(0,convert_case_1.humanCase)(a):(0,convert_case_1.humanCase)(e.name),objectParameterKey:e.name,presentationType:o}})).filter(js_util_1.notEmpty).filter((function(e){return d||!(0,name_conventions_1.isCalculatedParameter)(String(e.objectParameterKey))})),g=null===(r=null==o?void 0:o.data)||void 0===r?void 0:r.pages.map((function(e){var t;return null===(t=e.result)||void 0===t?void 0:t.data})).flat().filter(js_util_1.notEmpty),b=(0,js_util_1.sum)((null===(i=o.data)||void 0===i?void 0:i.pages.map((function(e){var t;return(null===(t=e.result)||void 0===t?void 0:t.data.length)||0})))||[]);return(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,{children:[(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,__assign({className:"px-8 lg:px-20 py-4"},{children:[(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,__assign({className:"flex flew-row justify-between pb-4"},{children:[u?(0,jsx_runtime_1.jsx)(react_with_native_1.Div,{}):f?(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,{children:[(0,jsx_runtime_1.jsx)(react_with_native_1.P,__assign({className:"font-bold"},{children:f.name})),(0,markdown_1.renderMarkdownContent)(f.description||"No description",{projectRelativeBaseFolderPath:(0,fs_util_js_1.getFolderJs)(f.projectRelativePath),projectRelativeMarkdownFilePath:f.projectRelativePath})]}):"No index found",(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,__assign({className:"flex flex-row"},{children:[(0,jsx_runtime_1.jsx)(labeled_button_1.LabeledButton,{onClick:function(){return h.push("/upsert/".concat(s))},title:"New",emoji:"‚ûï"}),(0,jsx_runtime_1.jsx)(labeled_button_1.LabeledButton,__assign({},{onClick:function(){return o.refetch()},title:"Reload",emoji:u?void 0:"üîÑ",component:u?function(){return(0,jsx_runtime_1.jsx)(fancy_loader_1.FancyLoader,{medium:!0})}:void 0})),(0,jsx_runtime_1.jsx)(labeled_button_1.LabeledButton,__assign({},{onClick:function(){return m(!d)},title:"Show all",emoji:d?"üîì":"üîí"}))]}))]})),u?null:0===b?"No entries loaded":"".concat(b," entries loaded")]})),Array.isArray(g)&&g.length>0?(0,jsx_runtime_1.jsx)(react_with_native_table_1.Table,{data:g,onEndReached:function(){var e,t,n=null===(e=o.data)||void 0===e?void 0:e.pages,a=n?n[n.length-1]:void 0;(null===(t=null==a?void 0:a.result)||void 0===t?void 0:t.hasMore)&&!o.isFetchingNextPage&&o.fetchNextPage()},shouldHighlightItem:function(e){return!!(l.id&&e.id===l.id||l.slug&&e.slug===l.slug)},columns:x,renderExtraColumns:function(e){return(0,jsx_runtime_1.jsxs)(react_with_native_1.Div,__assign({className:"flex flex-row"},{children:[(0,jsx_runtime_1.jsx)(labeled_button_1.LabeledButton,__assign({},{onClick:function(){return h.push("/upsert/".concat(s,"?id=").concat(null==e?void 0:e.id))},title:"Update",emoji:"‚úèÔ∏è",size:"small"})),(0,jsx_runtime_1.jsx)(labeled_button_1.LabeledButton,__assign({},{size:"small",onClick:function(){null==v||v("Are you sure?","Do you want to delete this one?",[{text:"Yes",style:"destructive",onPress:function(){(null==e?void 0:e.id)&&deleteDbModel(s,e.id).then((function(e){o.refetch(),_.refetch()}))}},{text:"Cancel",style:"cancel"}])},title:"Delete",emoji:"‚ùå"}))]}))},extraColumnsAtStart:!0}):null]})};exports.ModelComponent=ModelComponent;
//# sourceMappingURL=ModelComponent.js.map