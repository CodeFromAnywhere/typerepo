{
  "createdAt": 1671097068257,
  "updatedAt": 1671097068257,
  "deletedAt": 0,
  "createdFirstAt": 1671097068257,
  "classification": "const",
  "comments": [],
  "isExported": true,
  "name": "openAIChat",
  "slug": "open-aichat",
  "operationRelativeTypescriptFilePath": "src/openAIChat.ts",
  "type": {
    "rawType": "(props: import(\"/Users/lucky/workspace/typerepo/packages/niches/bhagya/doing/control-web/chatgpt-controller/src/openAIChat\").OpenAIChatProps) => Promise<import(\"/Users/lucky/workspace/typerepo/packages/niches/bhagya/doing/control-web/chatgpt-controller/src/openAIChat\").OpenAIChatResponseType>",
    "typeDefinition": {
      "type": "object",
      "properties": {},
      "optional": false
    },
    "typeCoverage": 0,
    "isArray": false,
    "isEnum": false,
    "isObject": true,
    "isPrimitive": false,
    "isEnumLiteral": false,
    "simplifiedSchema": {
      "properties": [],
      "type": "object"
    }
  },
  "value": "async (\n  props: OpenAIChatProps\n): Promise<OpenAIChatResponseType> => {\n  const { prompt, thread, isHeadless } = props;\n  console.log(\"openAIChat Called\", props);\n\n  // chat login test ...\n\n  const { page, pageId } = await openPage(thread);\n  if (!page) return { isSuccess: false, result: \"Faild to create page.\" };\n  if (thread !== pageId) {\n    await page.goto(\"https://chat.openai.com/chat\", {\n      waitUntil: \"domcontentloaded\",\n    });\n  }\n\n  let sendMessageButton = await page.$(\n    'button[class=\"absolute p-1 rounded-md text-gray-500 bottom-1.5 right-1 md:bottom-2.5 md:right-2 hover:bg-gray-100 dark:hover:text-gray-400 dark:hover:bg-gray-900 disabled:hover:bg-transparent dark:disabled:hover:bg-transparent\"]'\n  );\n  let isTextAreaExist = await page.$(\"textarea\");\n\n  if (!isTextAreaExist || !sendMessageButton) {\n    const pageType = await detectChatGptPage(page);\n    console.log({ pageType });\n    if (pageType === \"Login\") {\n      const authResponse = await chatGPTAuth(page);\n      console.log({ authResponse });\n      await new Promise((r) => setTimeout(r, 2000));\n    }\n  }\n\n  // Wating and typing the prompt in the textarea field\n  await page.waitForSelector(\"textarea\", { timeout: 60000 });\n  await page.waitForSelector(\n    'button[class=\"absolute p-1 rounded-md text-gray-500 bottom-1.5 right-1 md:bottom-2.5 md:right-2 hover:bg-gray-100 dark:hover:text-gray-400 dark:hover:bg-gray-900 disabled:hover:bg-transparent dark:disabled:hover:bg-transparent\"]',\n    { timeout: 60000 }\n  );\n\n  sendMessageButton = await page.$(\n    'button[class=\"absolute p-1 rounded-md text-gray-500 bottom-1.5 right-1 md:bottom-2.5 md:right-2 hover:bg-gray-100 dark:hover:text-gray-400 dark:hover:bg-gray-900 disabled:hover:bg-transparent dark:disabled:hover:bg-transparent\"]'\n  );\n  isTextAreaExist = await page.$(\"textarea\");\n\n  console.log({ isTextAreaExist, sendMessageButton });\n  if (isTextAreaExist && sendMessageButton) {\n    console.log(\"inside of set value\");\n    await new Promise(async (resolve, reject) => {\n      console.log(\"inside promise\");\n      resolve(\n        await page.evaluate((evPrompt) => {\n          const promtTextAreaField = document.getElementsByTagName(\"textarea\");\n          console.log({ promtTextAreaField });\n          if (promtTextAreaField[0]) {\n            //@ts-ignore\n            promtTextAreaField[0].focus();\n            promtTextAreaField[0].click();\n            promtTextAreaField[0].value = evPrompt;\n            const button = document.querySelector(\n              'button[class=\"absolute p-1 rounded-md text-gray-500 bottom-1.5 right-1 md:bottom-2.5 md:right-2 hover:bg-gray-100 dark:hover:text-gray-400 dark:hover:bg-gray-900 disabled:hover:bg-transparent dark:disabled:hover:bg-transparent\"]'\n            );\n            //@ts-ignore\n            button?.click();\n            return true;\n          }\n          console.log(\"TEXT AREA NOT FOUND\");\n        }, prompt)\n      );\n    });\n\n    // Waiting for re-appear send message button that show current prompt is completed\n    await page.waitForSelector(\n      'button[class=\"absolute p-1 rounded-md text-gray-500 bottom-1.5 right-1 md:bottom-2.5 md:right-2 hover:bg-gray-100 dark:hover:text-gray-400 dark:hover:bg-gray-900 disabled:hover:bg-transparent dark:disabled:hover:bg-transparent\"]',\n      { timeout: 300000 }\n    );\n\n    console.log(\"ANSWER IS COMPLETED\");\n    // finding the last answer\n    const result: string | undefined = await new Promise(\n      async (resolve, reject) => {\n        resolve(\n          await page.evaluate(() => {\n            // document.title = \"bhagya 1234\";\n            const allAnswer = document.querySelectorAll(\n              'div[class=\"w-full border-b border-black/10 dark:border-gray-900/50 text-gray-800 dark:text-gray-100 group bg-gray-50 dark:bg-[#444654]\"]'\n            );\n            console.log({ allAnswer });\n            if (allAnswer.length > 0) {\n              const lastAnswer = allAnswer[allAnswer.length - 1]?.children;\n              console.log({ lastAnswer });\n            }\n\n            return \"\";\n          })\n        );\n      }\n    );\n\n    return {\n      isSuccess: true,\n      result,\n      thread: pageId,\n    };\n  }\n  return { isSuccess: false, result: \"Text area not found\", thread };\n}",
  "description": "Send the propt to chatgpt and return the chatgpt response",
  "id": "dvbeqeztcaxcrrotcxmirkzg"
}