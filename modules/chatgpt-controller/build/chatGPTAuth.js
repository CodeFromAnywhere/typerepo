"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,s){function o(e){try{c(r.next(e))}catch(e){s(e)}}function i(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,i)}c((r=r.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var n,r,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,i[0]&&(o=0)),o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.chatGPTAuth=void 0;var puppeteer_utils_1=require("puppeteer-utils"),database_1=require("database"),chatGPTAuth=function(e){return __awaiter(void 0,void 0,void 0,(function(){var t,n,r,a,s,o,i,c,u,l;return __generator(this,(function(p){switch(p.label){case 0:return p.trys.push([0,23,,24]),console.log("Chatgpt login chandler called"),[4/*yield*/,database_1.db.get("MediaCredential")];case 1:return t=p.sent(),console.log({credentials:t}),n=(null==t?void 0:t.find((function(e){return"openai"===e.username})))||{email:"bhagyasah4u@gmail.com",password:"openai@199201"},console.log({openAICredential:n}),n?(a=(r=n||n).email,s=r.password,[4/*yield*/,e.goto("https://chat.openai.com/auth/login",{waitUntil:"domcontentloaded"})]):[2/*return*/,{isSuccessfull:!1,message:"Credential not found"}];case 2:return p.sent(),[4/*yield*/,e.$x("//h2[contains(., 'Checking if the site connection is secure')]")];case 3:return p.sent()?(console.log("Need to captcha solution"),[4/*yield*/,(0,puppeteer_utils_1.isCaptchaExist)(e)]):[3/*break*/,6];case 4:return o=p.sent(),console.log({isCaptchaExistRes:o}),[4/*yield*/,e.waitForSelector('button[class="btn flex justify-center gap-2 btn-primary"]')];case 5:p.sent(),p.label=6;case 6:return[4/*yield*/,e.$x("//button[contains(., 'Log in')]")];case 7:return i=p.sent(),Boolean(i[0])?(console.log("LOGIN PAGE DETECTED"),
//@ts-ignore
i[0].click(),[4/*yield*/,e.waitForNavigation({waitUntil:"domcontentloaded"})]):[3/*break*/,22];case 8:return p.sent(),[4/*yield*/,e.waitForSelector('input[id="username"]')];case 9:return p.sent(),[4/*yield*/,e.$('input[id="username"]')];case 10:return(c=p.sent())?(
//@ts-ignore
c.click(),[4/*yield*/,e.keyboard.type(a)]):[3/*break*/,12];case 11:
//@ts-ignore
p.sent(),p.label=12;case 12:return[4/*yield*/,(0,puppeteer_utils_1.isCaptchaExist)(e)];case 13:return p.sent().captchas.length>0?(console.log("CAPTCHA DETECTED"),[4/*yield*/,(0,puppeteer_utils_1.solveReptcha)(e)]):[3/*break*/,22];case 14:return u=p.sent(),console.log({captchaSolveResponse:JSON.stringify(u)}),u.error?[3/*break*/,22]:[4/*yield*/,e.waitForSelector('button[type="submit"]')];case 15:return p.sent(),[4/*yield*/,e.click('button[type="submit"]')];case 16:return p.sent(),[4/*yield*/,e.waitForSelector('input[name="password"]',{timeout:3e4})];case 17:return p.sent(),[4/*yield*/,e.focus('input[name="password"]')];case 18:return p.sent(),[4/*yield*/,e.keyboard.type(s)];case 19:return p.sent(),[4/*yield*/,e.waitForSelector('button[type="submit"]')];case 20:return p.sent(),[4/*yield*/,e.click('button[type="submit"]')];case 21:return p.sent(),e.waitForNavigation({waitUntil:"domcontentloaded"}),[2/*return*/,{isSuccessfull:!0,message:"Login Succcessfull"}];case 22:return[2/*return*/,{isSuccessfull:!1,message:"Login faild"}];case 23:return[2/*return*/,{isSuccessfull:!1,message:null==(l=p.sent())?void 0:l.message}];case 24:return[2/*return*/]}}))}))};exports.chatGPTAuth=chatGPTAuth;
//# sourceMappingURL=chatGPTAuth.js.map