{
  "createdAt": 1667634504912,
  "updatedAt": 1667634504912,
  "deletedAt": 0,
  "createdFirstAt": 1667634504912,
  "publicAuthorization": [
    "read-docs",
    "search"
  ],
  "isApiExposed": false,
  "isPostApi": false,
  "isGetApi": false,
  "isExported": true,
  "operationRelativeTypescriptFilePath": "src/components/ModelComponent.tsx",
  "commentsInside": [],
  "rawText": " ({\n  modelName,\n  highlight,\n}: {\n  modelName?: string;\n  highlight: {\n    slug?: string;\n    id?: string;\n  };\n}) => {\n  const model = useGetDbModelQuery(modelName as DbModelEnum);\n  const modelReferences = useReferencableModelDataQuery(\n    modelName as DbModelEnum\n  );\n\n  const isLoading = model.isLoading || model.isRefetching || model.isFetching;\n\n  const [showModelKeys, setShowModelKeys] = useState(false);\n\n  const alert = useAlert();\n  const router = useRouter();\n\n  const index = model.data?.pages[0].result?.index;\n  const properties = getProperties(index?.type?.typeDefinition);\n  const dataParameterNames = getDataParameterNames(properties);\n  const withOrWithoutModelKeys = (column: ColumnType<any>) =>\n    showModelKeys || !isCalculatedParameter(String(column.objectParameterKey));\n  const columns: ColumnType<any>[] = properties\n    .filter((property) => !dataParameterNames.includes(property.name))\n    .map((property) => {\n      const referenceParameterInfo = getReferenceParameterInfo(property.name);\n      const {\n        descriptor,\n        interfaceName,\n        isReferenceMultipleParameter,\n        isReferenceParameter,\n        isReferenceSingleParameter,\n      } = referenceParameterInfo;\n\n      const presentationType = isReferenceSingleParameter\n        ? \"referenceSingle\"\n        : isReferenceMultipleParameter\n        ? \"referenceMultiple\"\n        : \"text\";\n\n      const name =\n        isReferenceParameter && interfaceName\n          ? descriptor\n            ? humanCase(`${descriptor}-${interfaceName}`)\n            : humanCase(interfaceName)\n          : humanCase(property.name);\n\n      const column: ColumnType<any> = {\n        name,\n        objectParameterKey: property.name,\n        presentationType,\n      };\n      return column;\n    })\n    .filter(notEmpty)\n    .filter(withOrWithoutModelKeys);\n\n  const allData = model?.data?.pages\n    .map((x) => x.result?.data)\n    .flat()\n    .filter(notEmpty);\n  const count = sum(\n    model.data?.pages.map((x) => x.result?.data.length || 0) || []\n  );\n  return (\n    <Div>\n      <Div className=\"px-8 lg:px-20 py-4\">\n        <Div className=\"flex flew-row justify-between pb-4\">\n          {isLoading ? (\n            <Div />\n          ) : (\n            <Div>\n              <P className=\"font-bold\">\n                {index?.name || \"Couldn't find index\"}\n              </P>\n              <P>{index?.description}</P>\n            </Div>\n          )}\n\n          <Div className=\"flex flex-row\">\n            <LabeledButton\n              onClick={() => router.push(`/upsert?model=${modelName}`)}\n              title=\"New\"\n              emoji=\"➕\"\n            />\n\n            <LabeledButton\n              {...{\n                onClick: () => model.refetch(),\n                title: \"Reload\",\n                emoji: isLoading ? undefined : \"🔄\",\n                component: isLoading ? () => <FancyLoader medium /> : undefined,\n              }}\n            />\n\n            <LabeledButton\n              {...{\n                onClick: () => setShowModelKeys(!showModelKeys),\n                title: \"Show all\",\n                emoji: showModelKeys ? \"🔓\" : \"🔒\",\n              }}\n            />\n          </Div>\n        </Div>\n\n        {isLoading\n          ? null\n          : count === 0\n          ? \"No entries loaded\"\n          : `${count} entries loaded`}\n      </Div>\n      {/* NB: here a table view should be rendered */}\n      {Array.isArray(allData) && allData.length > 0 ? (\n        <Table\n          data={allData}\n          onEndReached={() => {\n            const pages = model.data?.pages;\n\n            const lastPage = pages ? pages[pages.length - 1] : undefined;\n\n            const hasMore = lastPage?.result?.hasMore;\n\n            if (hasMore && !model.isFetchingNextPage) {\n              model.fetchNextPage();\n            }\n          }}\n          shouldHighlightItem={(item: any) =>\n            !!(\n              (highlight.id && item.id === highlight.id) ||\n              (highlight.slug && item.slug === highlight.slug)\n            )\n          }\n          columns={columns}\n          renderExtraColumns={(item) => {\n            return (\n              <Div className=\"flex flex-row\">\n                <LabeledButton\n                  {...{\n                    onClick: () =>\n                      router.push(`/upsert?model=${modelName}&id=${item?.id}`),\n                    title: \"Update\",\n                    emoji: \"✏️\",\n                    size: \"small\",\n                  }}\n                />\n                <LabeledButton\n                  {...{\n                    size: \"small\",\n                    onClick: () => {\n                      alert?.(\n                        \"Are you sure?\",\n                        \"Do you want to delete this one?\",\n                        [\n                          {\n                            text: \"Yes\",\n                            style: \"destructive\",\n                            onPress: () => {\n                              if (item?.id) {\n                                deleteDbModel(modelName as any, item.id).then(\n                                  (result) => {\n                                    model.refetch();\n                                    modelReferences.refetch();\n                                  }\n                                );\n                              }\n                            },\n                          },\n                          { text: \"Cancel\", style: \"cancel\" },\n                        ]\n                      );\n                    },\n                    title: \"Delete\",\n                    emoji: \"❌\",\n                  }}\n                />\n              </Div>\n            );\n          }}\n          extraColumnsAtStart\n        />\n      ) : null}\n    </Div>\n  );\n}",
  "name": "ModelComponent",
  "slug": "model-component",
  "parameters": [
    {
      "name": "{\n  modelName,\n  highlight,\n}",
      "schema": {
        "type": "object",
        "properties": {
          "modelName": {
            "type": "string"
          },
          "highlight": {
            "type": "object",
            "properties": {
              "slug": {
                "type": "string"
              },
              "id": {
                "type": "string"
              }
            },
            "additionalProperties": false
          }
        },
        "required": [
          "highlight"
        ],
        "additionalProperties": false
      },
      "simplifiedSchema": {
        "properties": [
          {
            "name": "modelName",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "highlight",
            "required": true,
            "schema": {
              "properties": [
                {
                  "name": "slug",
                  "required": false,
                  "schema": {
                    "type": "string"
                  }
                },
                {
                  "name": "id",
                  "required": false,
                  "schema": {
                    "type": "string"
                  }
                }
              ],
              "type": "object"
            }
          }
        ],
        "type": "object"
      },
      "required": true
    }
  ],
  "description": "In the table headings, all xxxSlug, xxxId etc should be called xxx.\n\nIn the table values, all slugs and ids should show the name of the instance of the refered model.\n\nIt has to be possible to navigate to an id or slug using `#[id] or #[slug]` in the URL, just add div ids to all rows",
  "returnType": {
    "rawType": "JSX.Element",
    "typeDefinition": {
      "optional": false,
      "$ref": "#/definitions/JSX.Element"
    },
    "typeCoverage": 0,
    "isArray": false,
    "isEnum": false,
    "isObject": true,
    "isPrimitive": false,
    "isEnumLiteral": false
  },
  "maxIndentationDepth": 18,
  "size": {
    "characters": 6032,
    "lines": 193,
    "bytes": 6046,
    "bytesPerCharacter": 1.0023209549071619,
    "charactersPerLine": 31,
    "linesPerFile": 193,
    "numberOfFiles": 1
  },
  "id": "iyckoiojssnnjuvvznitemec"
}